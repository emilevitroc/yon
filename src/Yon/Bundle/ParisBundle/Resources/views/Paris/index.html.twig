{% extends 'baseAdmin.html.twig' %}
{% block title %}{{ parent() }}Liste des paris{% endblock %}
{% set menuParis = true %}
{% set menuParisAll = true %}
{% block stylesheets %}
    {{ parent() }}
<style type="text/css">
    #list-users_length, #list-users_filter {
        margin: 10px;
    }
    .btn-mini-rectif{
        margin-right: 5px;
    }
    .status-filter {
            bottom: -37px;
            left: 330px;
            position: relative;
            width: 400px;
            z-index: 2;
        }
    .list-count {
        font-size: 2.1em;
        font-weight: bold;
        text-align: center;
    }
</style>
{% endblock %}
{% block body %}
    {% for flashMessage in app.session.flashbag.get('success') %}
        <div class="callout callout-success">
            {{ flashMessage }}
        </div>
    {% endfor %}
    {% for flashMessage in app.session.flashbag.get('error') %}
        <div class="callout callout-danger">
            {{ flashMessage }}
        </div>
    {% endfor %}
        
    <div class="row">
        <div class="col-xs-12">
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title">Liste des paris</h3>
                    <div class="list-count">
                        <span class="title-count-text"> TOTAL: </span><span class="title-count"></span>
                    </div>

                    {#<div class="box-tools">
                        <div style="width: 150px;" class="input-group input-group-sm">
                            <input type="text" placeholder="Search" class="form-control pull-right" name="table_search">

                            <div class="input-group-btn">
                                <button class="btn btn-default" type="submit"><i class="fa fa-search"></i></button>
                            </div>
                        </div>
                    </div>#}
                </div>
                <!-- /.box-header -->
                <div class="status-filter">
                    <label for="status"> Status:</label>
                    <select id="status">
                        <option value="">Tous les paris</option>
                        <option value="0">paris en cours</option>
                        <option value="1">paris en attente de réponse</option>
                        <option value="2">paris passés</option>
                        <option value="3">paris expiré</option>
                        <option value="4">paris à venir</option>
                    </select>
                </div>
                <div class="box-body">
                    <table id="list-users" class="table  table-bordered table-striped">
                        <thead >
                             <tr>
                                <th>Id</th>
                                <th>Intitulé</th>
                                <th>Auteur</th>
                                <th>Heure de début</th>
                                <th>Heure de fin</th>
                                <th>hashtag</th>
                                <th>Nb de participants</th>
                                <th>Taux de réponse des différents choix</th>
                                <th>Concours</th>
                                {#<th>Betscount</th>
                                <th>Commentscount</th>
                                <th>Winnerscount</th>
                                <th>Status</th>
                                <th>Popularityscore</th>
                                <th>Startdate</th>
                                <th>Enddate</th>
                                <th>Creation</th>
                                <th>Delayedresult</th>#}
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                {#<div class="box-footer">
                    <a class="btn btn-primary pull-left" href="{{ path('apichallenge_moderate') }}">Moderer 50 paris</a>
                </div>#}
        </div>
    </div>
</div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
	<script type="text/javascript">
            var datat = null;
            $(function () {
                $('#list-users').DataTable(
                {
                    "pageLength": 100,
                    "aoColumns": [
                        {"bSortable": true}, {"bSortable": true}, {"bSortable": true}, {"bSortable": true}, {"bSortable": true},
                        {"bSortable": true}, {"bSortable": true}, {"bSortable": true}, {"bSortable": true}, {"bSortable": false}],
                    "order": [[ 0, "desc" ]],
                    "bProcessing": true,
                    "bServerSide": true,
                    "bFilter": true,
                    "sAjaxSource": Routing.generate('yon_paris_list_ajax',{
                                    'authUserId': '{{ authUserId }}'
                            }),
                    "oLanguage": {
                        "sProcessing": "traitement...",
                        "oPaginate": {
                            "sPrevious": "Précédante", // This is the link to the previous page
                            "sNext": "Suivante", // This is the link to the next page
                        },
                        "sSearch": "Filtrer: ",
                        "sLengthMenu": "Afficher _MENU_ enregistrement par page",
                    },
                    "drawCallback": function(settings) {
                        $('.title-count').html(settings.json.iTotalRecords);
                        //do whatever  
                     },
                });
                datat = $("#list-users").DataTable();
                $('#status').change(function() {
                
                    oTable = $('#list-users').dataTable();
                    var oSettings = oTable.fnSettings();
                    oSettings.sAjaxSource  = Routing.generate('yon_paris_list_ajax',{
                                    'status' : $('#status').val(),
                                    'authUserId': '{{ authUserId }}'
                            });
                    oTable.fnFilter($('.dataTables_filter input').val());
                } );
            });
            
            function addChallengeToContest(chalengeId){
                    bootbox.prompt({
                        title: "Choisir le concours à associer au paris",
                        inputType: 'select',
                        inputOptions: JSON.parse('{{ apiContests|raw }}'),
                        callback: function (contestId) {
                            if(contestId){
                                if(contestId != ""){
                                    $.ajax({
                                        type: "POST",
                                        url: '{{ path('apichallenge_add_challenge_to_contest_ajax')}}',
                                        cache: false,
                                        data: {challenge: chalengeId, contest: contestId},
                                        success: function(response){
                                            if(response.code == 'success') {
                                                console.log('success');
                                                datat.draw();
                                            } else {
                                                console.log(response.message);  
                                            }
                                        }
                                    });
                                } else {
                                    bootbox.alert("Vous devez choisir un concours");
                                }
                            }
                        }
                    });
            }
            
            function supprimerParis(challengeId){
                bootbox.confirm("Etes vous sur de vouloir supprimer ce paris?", function(result){ 
                    if(result){
                        $.ajax({
                            type: "POST",
                            url: '{{ path('apichallenge_delete_ajax')}}',
                            cache: false,
                            data: {challengeId: challengeId},
                            success: function(response){
                                if(response.code == 'success') {
                                    window.location.href = '{{ path('apichallenge_index') }}';
                                } else {
                                  console.log(response.message);  
                                }
                            }
                        });
                    }
                });
            }
            
	</script>
{% endblock %}

